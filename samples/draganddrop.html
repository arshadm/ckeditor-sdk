<!DOCTYPE html>
<!--
Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
For licensing, see license.html or http://sdk.ckeditor.com/license.html.
-->
<html>
<head>
	<meta charset="utf-8">
	<meta name="description" content="Drag and Drop Integration">
	<meta name="keywords" content="ckeditor, editor, wysiwyg, drag and drop, dropping into editor">
	<meta name="sdk-samples" content="Drag and Drop Integration">
	<title>Drag and Drop Integration</title>
	<link href="http://fonts.googleapis.com/css?family=Maven+Pro:700,500,400" rel="stylesheet">
	<link href="../theme/css/sdk.css" rel="stylesheet">
	<script src="../vendor/ckeditor/ckeditor.js"></script>
	<script src="assets/picoModal-2.0.1.min.js"></script>
	<script src="assets/sample.js"></script>
	<script src="assets/contentloaded.js"></script>
	<script src="assets/simplesample.js"></script>
	<script src="assets/beautify-html.js"></script>
	<!--[if lt IE 9]>
	<script src="assets/html5shiv.min.js"></script>
	<![endif]-->
	<link rel="icon" href="../theme/img/favicon.ico">
	<style data-sample="1">
		.columns::after {
			content: '';
			clear: both;
			display: block;
		}
		.columns > .editor {
			float: left;
			width: 600px;
		}
		.contactList {
			float: right;
			width: 250px;
			list-style-type: none;
		}
		.contactList .contact {
			background: #EEE;
			border-radius: 3px;
			margin-bottom: 1px;
			height: 30px;
			line-height: 30px;
		}
		.contact .u-photo {
			width: 30px;
			height: 30px;
			display: block;
			float: left;
		}
	</style>
</head>
<body>
	<header class="sdk-header">
	</header>
	<section class="sdk-container">
		<nav class="sdk-sidebar">
		</nav>
		<section class="sdk-contents">
			<h1>Drag and Drop Integration <a class="documentation" href="http://docs.ckeditor.com/#!/guide/dev_drop_paste">Documentation</a></h1>

			<p>TODO</p>

			<div class="columns" data-sample="1">
				<div class="editor">
					<textarea cols="10" id="editor1" name="editor1" rows="10" data-sample-short>
						<p>TODO</p>
					</textarea>
				</div>
				<ul class="contactList" id="contactList"></ul>
			</div>

			<script data-sample="1">
				'use strict';

				var CONTACTS = [
					{ name: 'Foo Bar 1', tel: '+48 1345 234 235', email: 'foo1@example.com' },
					{ name: 'Foo Bar 2', tel: '+45 2345 234 235', email: 'foo2@example.com' },
					{ name: 'Foo Bar 3', tel: '+44 3345 234 235', email: 'foo3@example.com' },
					{ name: 'Foo Bar 4', tel: '+20 4345 234 235', email: 'foo4@example.com' },
					{ name: 'Foo Bar 2', tel: '+45 2345 234 235', email: 'foo2@example.com' },
					{ name: 'Foo Bar 3', tel: '+44 3345 234 235', email: 'foo3@example.com' },
					{ name: 'Foo Bar 4', tel: '+20 4345 234 235', email: 'foo4@example.com' },
					{ name: 'Foo Bar 2', tel: '+45 2345 234 235', email: 'foo2@example.com' },
					{ name: 'Foo Bar 3', tel: '+44 3345 234 235', email: 'foo3@example.com' },
					{ name: 'Foo Bar 4', tel: '+20 4345 234 235', email: 'foo4@example.com' },
					{ name: 'Foo Bar 2', tel: '+45 2345 234 235', email: 'foo2@example.com' },
					{ name: 'Foo Bar 3', tel: '+44 3345 234 235', email: 'foo3@example.com' }
				];

				// Implements a simple widget that represents a contact details (see http://microformats.org/wiki/h-card).
				CKEDITOR.plugins.add( 'hcard', {
					requires: 'widget',

					init: function( editor ) {
						editor.widgets.add( 'hcard', {
							allowedContent: 'span(!h-card); a[href](!u-email,!p-name); span(!p-tel)',
							requiredContent: 'span(h-card)',
							pathName: 'hcard',

							upcast: function( el ) {
								return el.name == 'span' && el.hasClass( 'h-card' );
							}
						} );

						// This feature does not have a button, so we have to register it manually.
						editor.addFeature( editor.widgets.registered.hcard );

						// Handle dropping a contact by transforming contact object into an HTML.
						// Note: all pasted and dropped content is handled in one event - editor#paste.
						editor.on( 'paste', function( evt ) {
							var contact = evt.data.dataTransfer.getData( 'contact' );
							if ( !contact ) {
								return;
							}

							evt.data.dataValue =
								'<span class="h-card">' +
									'<a href="mailto:' + contact.email + '" class="p-name u-email">' + contact.name + '</a>' +
									' ' +
									'<span class="p-tel">(' + contact.tel + ')</span>' +
								'</span>';
						} );
					}
				} );

				// When an item in the contact list is dragged, copy its data into drag and drop data transfer.
				// This data is later read by editor#paste listener in the hcard plugin defined above.
				CKEDITOR.document.getById( 'contactList' ).on( 'dragstart', function( evt ) {
					// The target may be some element inside draggable div, so get the div.h-card.
					var target = evt.data.getTarget().getAscendant( 'div', true );

					// Initialization of CKEditor's data transfer facade is a necessary step to extend and unify
					// native browser capabilities. For instance, Internet Explorer does not support any other data type than 'text'.
					// Note: evt is and instance of CKEDITOR.dom.event, not a native event.
					CKEDITOR.plugins.clipboard.initDragDataTransfer( evt );

					var dataTransfer = evt.data.dataTransfer;

					// We pass an object with contact details. Based on it, the editor#paste listener in the hcard plugin
					// will create HTML to be inserted into editor. We could set text/html here as well, but:
					// * it is more elegant and logical solution that this logic is kept in the hcard plugin,
					// * we do not know now where the content will be dropped and the HTML to be inserted
					// might vary depend on the drop target.
					dataTransfer.setData( 'contact', CONTACTS[ target.data( 'contact' ) ] );

					// We need to set some normal data types to a backup values for two reasons:
					// * on some browsers this is necessary to enable drag and drop into text in editor,
					// * the content may be dropped in other place than editor.
					dataTransfer.setData( 'text/html', target.getText() );
				} );

				// Initialize editor with the hcard plugin.
				CKEDITOR.replace( 'editor1', {
					extraPlugins: 'hcard',
					height: 400,

					// Load the default contents.css file plus customizations for this sample.
					contentsCss: [ CKEDITOR.basePath + 'contents.css', 'assets/draganddrop/contents.css' ]
				} );


			</script>

			<!--
				Used separate script, so this code does not get into the sample source code to download.
				It is not needed there because that mechanism gets content by reading innerHTML, hence everything is in place.
			-->
			<script>
				addItems(
					CKEDITOR.document.getById( 'contactList' ),
					new CKEDITOR.template(
						'<div class="contact h-card" data-contact="{id}">' +
							'<img src="https://github.com/identicons/{avatar}.png" alt="avatar" width="420" height="420" class="u-photo" /> {name}' +
						'</div>'
					),
					CONTACTS
				);

				function addItems( listElement, template, items ) {
					for ( var i = 0, draggable, item; i < items.length; i++ ) {
						item = new CKEDITOR.dom.element( 'li' );
						draggable = CKEDITOR.dom.element.createFromHtml(
							template.output( {
								id: i,
								name: items[ i ].name,
								avatar: items[ i ].name.replace( /\s/g, '' )
							} )
						);
						draggable.setAttributes( {
							draggable: 'true',
							tabindex: '0'
						} );

						item.append( draggable );
						listElement.append( item );
					}
				}
			</script>
		</section>
	</section>

	<footer class="sdk-footer">
	</footer>
</body>
</html>